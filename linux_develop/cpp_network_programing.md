# C++服务器编程

## TCP网络编程

三个半事件。

 ### 连接建立

accept新连接、connect新连接。

### 连接断开

主动断开（close、shutdown）、被动断开（read到0）。

### 消息到达

fd可读。阻塞or非阻塞、分包处理、应用层缓存设计。

### 消息发送完毕

指写入操作系统缓冲区，对端不一定已经接收到数据。

## 经验

### 希望将外部参数传入线程执行函数void\*(void\*)，并且使得传入资源自动释放

- 将外部参数传入线程执行函数

  使用malloc，传指针给执行函数，并在执行函数内手动free。（正道？）

- 自动管理的思路

  - 考虑将shared_ptr转换为void\*传入函数（暂时想不到实现）
  - 考虑提供将function\<void(void\*)\>传入pthread_create()（貌似行不通）


### ENOTCONN

read时发现连接并没有建立（数据发送不完整？）。

- 客户端尝试使用shutdown来告知？

### iostream并非线程安全

- 高效日志设计
